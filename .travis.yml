env:
  global:
    - CC_TEST_REPORTER_ID=ff7add7a0f454aff7e13c739a06a7aba8e5c8229d3e776e051294341b4721871
addons:
  artifacts: true
language: python
python:
  - "3.5"
  - "3.6"
#  - "nightly"
cache: pip
before_install:
  - wget 'https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb' -O /tmp/chrome.deb && sudo dpkg -i /tmp/chrome.deb && sudo apt-get install -y -f --fix-missing
  - sudo apt-get -y install nodejs python-setuptools libwebp-dev
  - python -V
  - pwd
  - chmod +x helpers/after_script.sh
  - chmod +x helpers/before_deploy.sh
  - chmod +x helpers/before_script.sh
  - source ./helpers/before_script.sh
install:
  - npm install -g less less-plugin-clean-css html-minifier
  - pip install --upgrade coverage codeclimate-test-reporter setuptools pyinstaller pyvirtualdisplay
  - pip install -r requirements.txt
before_script:
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build
script:
  - coverage run --omit=manga_dl/providers/*.py --source=manga_dl tests/pytest.py
after_script:
  - source ./helpers/after_script.sh
before_deploy:
  - echo "$allow_deploy"
  - echo "Start make gh-pages content"
  - source ./helpers/before_deploy.sh
deploy:
  - provider: pages
    edge:
      branch: v1.8.47
    local-dir: helpers/gh_pages_content
    target-branch: gh-pages
    github-token: $GH_TOKEN
    skip-cleanup: true
    skip_cleanup: true
    on:
      branch: master
      condition: $allow_deploy == true
      tags: false
  - provider: pypi
    server: https://upload.pypi.org/legacy/
    user: 1271
    password:
      secure: "F0yAFJ0Oe8sE+ARZuZIxhJ7Qcl4lAvDL1B8mTnX12KFqYKG6VF+LRR5MYemi394EC9+iaDq6k9OO0uaz6SHiB4buAvvF6RizNiVbeF2v6ZknGGCHF4uMiI7AgulVei3j7GW3YfTCBSbMZWpiM9cKLry3ubd3/5hyZNjJHS2DSAD3mIdPXmBKQyQkoyI+vzIuTyERZYqONu+eQLNSrSpL5nb2uLnU9YS/1htVKaD9FXT9fP3xQajqfQMuaWj4FeFwzN2zy20TNX9f0zdC6qIPURr6JdNU6OmdPrebOD+kik2x1ng9QqftJXxOsuw+ZYRqVacORjEDdIedZ5hwp+rwSTfpT3R9be+2LMl8IRl7tDU5m/vzQHwrc1UhBqT9SeOIkedoScUEAYrKBBPD1t9y2nXM4X3va6sG/DB9fpEz5mNtXGNDEby4eFjDbWkK4Q2XX4Hh+iMUDZzjr4eJc5Y1QF5LVR+B8WiSJZF3ze620MXJMTwfc9zYm9d3qiZt154+Psn+LSsIowpHxLjUVvfWySx1396Vw28/vpYuWnWLRSrOkc+VAOLLawCiseJLWCS2s13w2frA0CukY8nZ8jgF2zoLmN4t44Lp4WSlcplTXfmToY01FHsxdPHJ2F+mAkyFwVWHEpb7NcTWmgwSr1v+s3hseDhhgmDvwhTyuhx487I="
    skip_cleanup: true
    on:
      branch: master
      tags: true
      condition: $allow_deploy == true
#    fqdn: yuru-yuri.sttv.me
#see https://docs.travis-ci.com/user/deployment/pages/
allow_failures:
  - python: nightly
