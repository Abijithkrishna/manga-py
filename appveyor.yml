version: 0.2.{build}
skip_non_tags: true
image: Visual Studio 2015
clone_folder: C:\projects\manga-downloader
init:
- ps: git config --global core.autocrlf false
environment:
  PIP: C:/Python35/Scripts/pip.exe
  PYTHON: C:/Python35/python.exe
install:
- ps: >-
    cd C:\projects\manga-downloader

    cp helpers/.builder.py ./

    cp helpers/.gui.py ./

    C:/Python35/Scripts/pip.exe install --disable-pip-version-check --user --upgrade pip setuptools

    C:/Python35/Scripts/pip.exe install pyinstaller PyQt5

    C:/Python35/Scripts/pip.exe install -r requirements.txt
build: off
test_script:
- cmd: >-
    cd "C:\Python35\Scripts"

    dir

    cd C:\projects\manga-downloader

    C:/Python35/Scripts/pyinstaller.exe .builder.py --exclude-module PIL.ImageQt --log-level CRITICAL -y -F -n manga.exe
#    C:/Python35/Scripts/pyinstaller.exe .gui.py --exclude-module PIL.ImageQt --log-level CRITICAL -y -F -n mangaGui.exe
artifacts:
- path: dist/manga.exe
  name: manga.exe
  type: WebDeployPackage
deploy:
- provider: GitHub
  auth_token:
    secure: aqxOwrvNEIZ2ian/bj0ZyfEzMFNWalV5zDfFqpcxfZX47FAIW9ud6kgCU2jm/fMk
  draft: true
  prerelease: true
  force_update: true
  on:
    branch: master
